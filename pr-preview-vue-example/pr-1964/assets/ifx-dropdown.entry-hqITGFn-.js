import{r as h,c as a,h as l,g as c}from"./index-DFKlDfSw.js";import{d,t as p}from"./framework-detection-1487baf5-BMsXG9Ok.js";import{i as u}from"./dom-utils-1988cdf1-CZY0_Num.js";import{c as f}from"./popper-1604923e-CMBiYTiD.js";const m=":host{display:inline-block}",g=m,w=class{constructor(t){h(this,t),this.ifxOpen=a(this,"ifxOpen",7),this.ifxClose=a(this,"ifxClose",7),this.ifxDropdown=a(this,"ifxDropdown",7),this.placement="bottom-start",this.defaultOpen=!1,this.internalIsOpen=!1,this.noAppendToBody=!1,this.noCloseOnOutsideClick=!1,this.noCloseOnMenuClick=!1,this.handleTriggerClick=()=>{this.internalIsOpen?this.closeDropdown():this.openDropdown()},this.handleTriggerKeyDown=e=>{e.key==="Tab"&&this.internalIsOpen&&!e.shiftKey&&(e.preventDefault(),this.focusFirstItem())},this.handleMenuClick=()=>{this.noCloseOnMenuClick||this.closeDropdown()},this.handleMenuKeyDown=e=>{var i,s,o;const n=this.getItemFocusables();if(!n.length)return;const r=n.indexOf(document.activeElement);switch(e.key){case"ArrowDown":e.preventDefault(),n[(r+1)%n.length].focus();break;case"ArrowUp":e.preventDefault(),n[(r-1+n.length)%n.length].focus();break;case"Home":e.preventDefault(),n[0].focus();break;case"End":e.preventDefault(),n[n.length-1].focus();break;case"Enter":case" ":case"Spacebar":e.preventDefault(),(i=document.activeElement)===null||i===void 0||i.click();break;case"Escape":e.preventDefault(),this.closeDropdown(),(s=this.trigger)===null||s===void 0||s.focus();break;case"Tab":e.shiftKey&&r===0&&(e.preventDefault(),this.closeDropdown(),(o=this.trigger)===null||o===void 0||o.focus());break}}}handleOutsideClick(t){const e=t.target;!this.noCloseOnOutsideClick&&!this.el.contains(e)&&!this.menu.contains(e)&&this.closeDropdown()}handleFocusOutside(t){const e=t.target;this.internalIsOpen&&!this.el.contains(e)&&!this.menu.contains(e)&&this.closeDropdown()}getItemFocusables(){return this.menu?Array.from(this.menu.querySelectorAll("ifx-dropdown-item")).filter(e=>!(e.getAttribute("hide")==="true"||e.classList.contains("hide"))).map(e=>{var i;return(i=e.shadowRoot)===null||i===void 0?void 0:i.querySelector("a")}).filter(e=>!!e):[]}componentWillLoad(){this.updateSlotContent(),this.watchHandlerIsOpen(this.defaultOpen,this.internalIsOpen)}async componentDidLoad(){if(!u(this.el)){const t=d();p("ifx-dropdown",await t)}}watchHandlerIsOpen(t,e){t!==e&&t!==this.internalIsOpen&&(t?this.openDropdown():this.closeDropdown())}watchHandlerDisabled(t){this.trigger&&(this.trigger.disabled=t)}watchHandlerSlot(){this.updateSlotContent()}focusFirstItem(){const[t]=this.getItemFocusables();t==null||t.focus()}updateSlotContent(){const t=this.el.querySelector("ifx-dropdown-trigger-button, ifx-dropdown-trigger");t!==this.trigger&&(this.trigger&&(this.trigger.removeEventListener("click",this.handleTriggerClick),this.trigger.removeEventListener("keydown",this.handleTriggerKeyDown)),this.trigger=t,this.trigger&&(this.trigger.disabled=this.disabled,this.trigger.addEventListener("click",this.handleTriggerClick),this.trigger.addEventListener("keydown",this.handleTriggerKeyDown)));const e=this.el.querySelector("ifx-dropdown-menu");this.noAppendToBody?this.menu=e:(this.menu&&this.menu!==e&&(this.menu.removeEventListener("click",this.handleMenuClick),this.menu.removeEventListener("keydown",this.handleMenuKeyDown),this.menu.remove()),this.menu=e,this.menu&&!document.body.contains(this.menu)&&document.body.append(this.menu)),this.menu&&(this.menu.removeEventListener("click",this.handleMenuClick),this.menu.removeEventListener("keydown",this.handleMenuKeyDown),this.menu.addEventListener("click",this.handleMenuClick),this.menu.addEventListener("keydown",this.handleMenuKeyDown))}menuClickHandler(){this.noCloseOnMenuClick||this.closeDropdown()}disconnectedCallback(){this.popperInstance&&(this.popperInstance.destroy(),this.popperInstance=null),this.menu&&this.menu.remove()}async isOpen(){return this.internalIsOpen}async closeDropdown(){this.internalIsOpen&&(this.internalIsOpen=!1,this.trigger.isOpen=!1,this.menu.isOpen=!1,this.ifxClose.emit()),this.popperInstance&&(this.popperInstance.destroy(),this.popperInstance=null)}async openDropdown(){!this.internalIsOpen&&!this.disabled&&(this.internalIsOpen=!0,this.trigger.isOpen=!0,this.menu.isOpen=!0,this.popperInstance=f(this.el,this.menu,{placement:this.placement}),this.ifxOpen.emit())}render(){return l("div",{key:"81a61850906f9ae3b89d44fceb3a9c1a693e3954","aria-label":"dropdown menu",class:"dropdown"},l("slot",{key:"427d5eeda7a0c1c94523a867c4b73f99c14cc57c"}))}get el(){return c(this)}static get watchers(){return{defaultOpen:["watchHandlerIsOpen"],disabled:["watchHandlerDisabled"]}}};w.style=g;export{w as ifx_dropdown};
