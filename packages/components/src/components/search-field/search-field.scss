@use "~@infineon/design-system-tokens/dist/tokens";

:host {
  display: flex;
}

.search-field {
  box-sizing: border-box;
  background-color: tokens.$ifxColorBaseWhite;
  width: 100%;
  font-family: var(--ifx-font-family);
  position: relative; // Wichtig f√ºr absolute positioning des Dropdowns

  .search-field__wrapper {
    box-sizing: border-box;
    height: tokens.$ifxSize500;
    display: flex;
    align-items: center;
    border: 1px solid #8d8786;
    border-radius: tokens.$ifxBorderRadius12;
    padding: tokens.$ifxSpace100 tokens.$ifxSpace200;
    gap: tokens.$ifxSpace150;
    flex: none;
    order: 0;
    align-self: stretch;
    flex-grow: 0;
    position: relative;
    width: 100%;
    outline: none;

    &:focus-visible:not(.disabled) {
      outline: 2px solid tokens.$ifxColorOcean500;
      outline-offset: 2px;
    }

    &.search-field__wrapper-s {
      height: 36px;
    }

    &:hover:not(.focused, :focus) {
      border: 1px solid #3c3a39;
    }

    & .delete-icon {
      outline: 1px solid transparent;
      right: 12px;
      cursor: pointer;
      &:focus-visible {
        outline: 2px solid tokens.$ifxColorOcean500;
        outline-offset: 1px;
      }
    }

    input[type='text'] {
      font-style: normal;
      font-weight: 400;
      font-size: 16px;
      //line-height: 24px;
      color: #8d8786;
      border: none;
      width: 100%;
      outline: none;
      //height: 100%;
      height: 16px;

      &:focus {
        outline: none;
        color: #1d1d1d;
      }

      &:disabled {
        background: tokens.$ifxColorEngineering300;
        color: tokens.$ifxColorBaseWhite;

        &::placeholder {
          color: tokens.$ifxColorBaseWhite;
        }
      }
    }

    &.disabled {
      background: tokens.$ifxColorEngineering300;
      border: none;
      color: tokens.$ifxColorBaseWhite;

      &:hover {
        border: none;
        outline: none;
      }

      & .delete-icon { 
        cursor: default;
        &:focus-visible { 
          outline: 1px solid transparent;
        }
      }
    }
  }

  // Suggestions Dropdown Styles
  .suggestions-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: tokens.$ifxColorBaseWhite;
    margin-top: tokens.$ifxSpace50;
    border: 1px solid tokens.$ifxColorEngineering200;
    box-shadow: 0px 6px 9px 0px rgba(29, 29, 29, 0.1);
    z-index: 1000;
    max-height: 300px;
    overflow-y: auto;
    container-type: inline-size; // Enable container queries

    .suggestions-header {
      // font: tokens.$ifxEyebrowEyebrow02; TODO
      font-family: Source Sans 3;
      font-size: 0.8125rem;
      font-weight: 600;
      line-height: 1.25rem;

      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: tokens.$ifxColorEngineering500;
      border-bottom: 1px solid tokens.$ifxColorEngineering200;
      padding: tokens.$ifxSpace150 tokens.$ifxSpace200;
    }

    .suggestion-item {
      padding: tokens.$ifxSpace150 tokens.$ifxSpace200;
      cursor: pointer;
      transition: background-color 0.2s ease;

      &:last-child {
        border-bottom: none;
      }

      &:hover,
      &--selected {
        background-color: tokens.$ifxColorEngineering200;
      }

      .suggestion-content {
        display: flex;
        align-items: center;
        gap: tokens.$ifxSpace150;

        .suggestion-icon {
          color: tokens.$ifxColorEngineering500;
          flex-shrink: 0;

          &--history {
            color: tokens.$ifxColorEngineering500;
          }
        }

        .suggestion-text {
          flex: 1;
          display: flex;
          align-items: center;
          min-width: 0; // Important for flexbox truncation

          .suggestion-main-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex-shrink: 1;
            min-width: 0;
          }

          .suggestion-scope {
            color: tokens.$ifxColorEngineering400;
            flex-shrink: 0; // Never truncate the scope
            white-space: nowrap;
            margin-left: tokens.$ifxSpace25; // Add space before the scope
            font-weight: tokens.$ifxFontWeightSemibold;
            font-size: tokens.$ifxFontSizeXs;
          }

          // When container is narrow, stack scope below main text
          @container (max-width: 320px) {
            flex-direction: column;
            align-items: flex-start;

            .suggestion-main-text {
              width: 100%;
              max-width: 100%;
            }

            .suggestion-scope {
              margin-left: 0;
              margin-top: 0;
              width: 100%;
              max-width: 100%;
              overflow: hidden;
              text-overflow: ellipsis;
              flex-shrink: 1; // Allow truncation when narrow
            }
          }
        }

        .suggestion-count {
          color: tokens.$ifxColorEngineering400;
          margin-left: auto;
          flex-shrink: 0;
        }

        .suggestion-delete-icon {
          opacity: 0;
          visibility: hidden;
          transition: opacity 0.2s ease, visibility 0.2s ease;
          cursor: pointer;
          margin-left: auto;
          flex-shrink: 0;
          color: tokens.$ifxColorEngineering500;

          &:hover {
            color: tokens.$ifxColorEngineering600;
          }
        }
      }

      &:hover {
        .suggestion-delete-icon {
          opacity: 1;
          visibility: visible;
        }
      }
    }
  }

  // Wrapper modifications when dropdown is open
  .search-field__wrapper.dropdown-open {
    border-radius: tokens.$ifxBorderRadius12 tokens.$ifxBorderRadius12 0 0;
    border-color: tokens.$ifxColorOcean500;
  }
}
